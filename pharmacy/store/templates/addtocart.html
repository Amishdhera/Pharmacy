
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <table>
        <tr>
            <th><h5>Items: <strong>{{ order.get_cart_items }}</strong></h5></th>
            <th><h5>Total: <strong>{{ order.get_cart_total }}</strong></h5></th>
        </tr>
    
        {% for item in items %}
        <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.product.price }}</td>
            <td>{{ item.quantity }}</td>
        </tr>
        {% endfor %}
    </table>
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>

        <script>
        // 1. Get all buttons with class 'update-cart'
        var updateBtns = document.getElementsByClassName('update-cart')
   
        for (var i = 0; i < updateBtns.length; i++) {
            updateBtns[i].addEventListener('click', function(){
                var productId = this.dataset.product
                var action = this.dataset.action
                console.log('productId:', productId, 'Action:', action)
   
                // 2. Check if user is logged in
                var user = "{{ request.user }}"
                if (user === "AnonymousUser"){
                    console.log("User is not logged in")
                    // Redirect to login or handle guest cart here
                    window.location.href = "/login/"
                } else {
                    updateUserOrder(productId, action)
                }
            })
        }
   
        // 3. Send data to views.py
        function updateUserOrder(productId, action){
            var url = '/update_item/'
   
            fetch(url, {
                method:'POST',
                headers:{
                    'Content-Type':'application/json',
                    'X-CSRFToken': '{{ csrf_token }}', // Django CSRF Token
                },
                body:JSON.stringify({'productid':productId, 'action':action})
            })
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                console.log('Data:', data)
                location.reload()
            });
        }
    </script>
</body>
</html>

